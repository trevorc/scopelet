var f=null;
(function(){function h(a,b){this.n=a;this.parent=b}function e(a){this.z=a;this.o=0;this.g=""}function i(a,b){this.type=a;this.e=b}function k(a){this.w=a;this.d=0;this.i=j.k}function m(a){a=new e(new k(a));a.G();this.A=a.H()}h.prototype.push=function(a,b,c){a=this.v(a);if(a!=f)b(new h(a,this));else c!=f&&c()};h.prototype.repeat=function(a,b){var c=this.n,l;if(c!=f){if(c.length==f)throw new TypeError("expected array, got "+typeof c+" ("+JSON.stringify(c)+")");for(l=0;l<c.length;++l)a(new h(c[l],this))}else b!=
f&&b()};h.prototype.v=function(a){var b=a.split("."),c;if(a==="@")return this.n;for(a=this;a!=f&&c==f;a=a.parent)c=a.n[b[0]];for(a=1;a<b.length&&c!=f;++a)c=c[b[a]];return c};h.prototype.expand=function(a){var b=this.v(a);if(b==f)throw new ReferenceError('could not resolve "'+a+'"');return b};var g=0,d={s:g++,r:g++,t:g++,q:g++,l:g++,j:g++,c:g++};e.prototype.m=function(){var a=this.z.next();if(arguments.length>0&&Array.prototype.indexOf.call(arguments,a.type)===-1)throw new TypeError("expected "+Array.prototype.join.call(arguments,
", ")+", got "+a.type+" ("+a.e+")");return a};e.prototype.a=function(a){this.g+=Array(this.o).join(" ");this.g+=a;this.g+="\n"};e.prototype.f=function(){this.o+=2};e.prototype.h=function(){this.o-=2};e.prototype.end=function(){if(this.m(d.l,d.j).type===d.l){this.h();this.a("}, function() {");this.f();this.b();this.m(d.j)}this.h();this.a("});")};e.prototype.D=function(a,b){this.a("c.push('"+a+"', function(c) {");this.f();b==f?this.b():b();this.end()};e.prototype.repeat=function(a){if(a!=f){this.a("c.push('"+
a+"', function(c) {");this.f()}this.a("c.repeat(function(c) {");this.f();this.b();this.end();if(a!=f){this.h();this.a("});")}};e.prototype.quote=function(a){return a.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\n/g,"\\n")};e.prototype.F=function(a){this.a("s += '"+this.quote(a)+"';")};e.prototype.expand=function(a){this.a("s += c.expand('"+a+"');")};e.prototype.b=function(){var a=this.m();switch(a.type){case d.s:this.D(a.e);return this.b();case d.r:this.repeat(a.e);return this.b();case d.t:this.F(a.e);
return this.b();case d.q:this.expand(a.e);return this.b();case d.c:return d.c;default:this.z.C(a);return f}};e.prototype.B=function(){do{g=this.b();if(g==f)throw new SyntaxError("expected expression (got "+g+")");}while(g!==d.c)};e.prototype.G=function(){this.f();this.a("s = '';");this.B();this.a("return s;");this.h()};e.prototype.H=function(){return new Function("c",this.g)};e.prototype.toString=function(){return"function(c) {\n"+this.g+"}\n"};g=0;var j={k:g++,p:g++,c:g++};k.prototype.pushState=
function(a){this.u=this.i;this.i=a};k.prototype.next=function(){var a,b,c;if(this.d>=this.w.length){this.pushState(j.c);return new i(d.c)}c=this.w.slice(this.d);switch(this.i){case j.c:throw Error("EOF");case j.k:b=c.indexOf("{");if(b===-1)b=c.length;tok=new i(d.t,c.slice(0,b));b++;this.pushState(j.p);break;case j.p:a=/^(\.\w+)\s*([\w-]+)?\}|^([^.][^}]*)\}/.exec(c);if(a==f)throw new SyntaxError("expected }, got "+c.slice(0,24));b=a[0].length;if(a[1])switch(a[1]){case ".section":tok=new i(d.s,a[2]);
break;case ".repeat":tok=new i(d.r,a[2]);break;case ".or":tok=new i(d.l);break;case ".end":tok=new i(d.j);break;default:throw new SyntaxError("unknown directive "+a[1]);}else tok=new i(d.q,a[3]);this.pushState(j.k)}this.d+=b;tok.d=b;return tok};k.prototype.C=function(a){this.d-=a.d;this.i=this.u;delete this.u};m.prototype.expand=function(a){return this.A(new h(a))};this.scopelet={compile:function(a){return new m(a)}}}).call(this);
